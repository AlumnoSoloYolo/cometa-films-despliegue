<!-- src/app/components/admin-panel/admin-panel.component.html -->
<div class="admin-container">
  <div class="admin-wrapper">

    <!-- Header del Panel -->
    <div class="admin-header fade-in">
      <h1>Panel de Administración</h1>
      <div class="admin-user-info">
        <div class="admin-user-details">
          <span>Bienvenido, <strong>{{ currentUser?.username }}</strong></span>
          @if (userPermissions) {
          <span class="user-role-badge" [ngClass]="'role-' + userPermissions.role">
            {{ userPermissions.role }}
          </span>
          }
        </div>
        <button class="logout-btn" (click)="logout()">
          <i class="fas fa-sign-out-alt"></i>
          Cerrar Sesión
        </button>
      </div>
    </div>

    <!-- Navegación Principal -->
    <nav class="admin-nav">
      <button class="nav-tab" [class.active]="tabState.activeTab === 'dashboard'" (click)="showTab('dashboard')">
        <i class="fas fa-chart-dashboard"></i>
        Dashboard
      </button>

      <button class="nav-tab" [class.active]="tabState.activeTab === 'users'" (click)="showTab('users')"
        *ngIf="canManageUsers">
        <i class="fas fa-users"></i>
        Usuarios
      </button>

      <button class="nav-tab" [class.active]="tabState.activeTab === 'content'" (click)="showTab('content')"
        *ngIf="canModerateContent">
        <i class="fas fa-shield-alt"></i>
        Contenido
      </button>

      <button class="nav-tab" [class.active]="tabState.activeTab === 'reports'" (click)="showTab('reports')"
        *ngIf="isModerator">
        <i class="fas fa-flag"></i>
        Reportes
      </button>

      <button class="nav-tab" [class.active]="tabState.activeTab === 'settings'" (click)="showTab('settings')"
        *ngIf="isAdmin">
        <i class="fas fa-cogs"></i>
        Configuración
      </button>
    </nav>

    <!-- Dashboard Tab -->
    <div id="dashboard" class="tab-content" [class.active]="tabState.activeTab === 'dashboard'">

      @if (loading.stats) {
      <div class="loading">
        <i class="fas fa-spinner fa-spin"></i>
        Cargando estadísticas...
      </div>
      }

      @if (errors.stats) {
      <div class="error-message">
        <i class="fas fa-exclamation-triangle"></i>
        {{ errors.stats }}
      </div>
      }

      @if (stats && stats.overview && !loading.stats) {
      <div class="stats-grid fade-in">
        <div class="stat-card">
          <div class="stat-number">{{ stats.overview.totalUsers }}</div>
          <div class="stat-label">
            <i class="fas fa-users"></i>
            Total Usuarios
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-number">{{ stats.overview.activeUsers }}</div>
          <div class="stat-label">
            <i class="fas fa-user-check"></i>
            Usuarios Activos
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-number">{{ stats.overview.bannedUsers }}</div>
          <div class="stat-label">
            <i class="fas fa-user-times"></i>
            Usuarios Baneados
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-number">{{ stats.overview.totalReviews }}</div>
          <div class="stat-label">
            <i class="fas fa-star"></i>
            Total Reseñas
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-number">{{ stats.overview.totalComments }}</div>
          <div class="stat-label">
            <i class="fas fa-comments"></i>
            Total Comentarios
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-number">{{ stats.overview.totalLists }}</div>
          <div class="stat-label">
            <i class="fas fa-list"></i>
            Total Listas
          </div>
        </div>
      </div>

      <!-- Estadísticas de Hoy -->
      <div class="admin-card">
        <h3>
          <i class="fas fa-calendar-day"></i>
          Actividad de Hoy
        </h3>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-number">{{ stats.today.newUsers }}</div>
            <div class="stat-label">Nuevos Usuarios</div>
          </div>

          <div class="stat-card">
            <div class="stat-number">{{ stats.today.newReviews }}</div>
            <div class="stat-label">Nuevas Reseñas</div>
          </div>

          <div class="stat-card">
            <div class="stat-number">{{ stats.today.newComments }}</div>
            <div class="stat-label">Nuevos Comentarios</div>
          </div>

          <div class="stat-card">
            <div class="stat-number">{{ stats.today.newLists }}</div>
            <div class="stat-label">Nuevas Listas</div>
          </div>
        </div>
      </div>
      }
    </div>

    <!-- Users Tab -->
    <div id="users" class="tab-content" [class.active]="tabState.activeTab === 'users'" *ngIf="canManageUsers">
      <div class="admin-card">
        <h3>
          <i class="fas fa-users-cog"></i>
          Gestión de Usuarios
        </h3>

        <!-- Formulario de Búsqueda -->
        <form [formGroup]="userSearchForm" class="search-filters">
          <input type="text" class="search-input" placeholder="Buscar por username o email..." formControlName="search">

          <select class="filter-select" formControlName="role">
            <option value="">Todos los roles</option>
            <option value="admin">Administrador</option>
            <option value="moderator">Moderador</option>
            <option value="premium">Premium</option>
            <option value="user">Usuario</option>
          </select>

          <select class="filter-select" formControlName="status">
            <option value="">Todos los estados</option>
            <option value="active">Activos</option>
            <option value="banned">Baneados</option>
          </select>

          <button type="button" class="search-btn">
            <i class="fas fa-search"></i>
            Buscar
          </button>
        </form>

        @if (loading.users && users.length === 0) {
        <div class="loading">
          <i class="fas fa-spinner fa-spin"></i>
          Cargando usuarios...
        </div>
        }

        @if (errors.users) {
        <div class="error-message">
          <i class="fas fa-exclamation-triangle"></i>
          {{ errors.users }}
        </div>
        }

        @if (users.length > 0) {
        <div class="table-container">
          <table class="admin-table">
            <thead>
              <tr>
                <th>Usuario</th>
                <th>Email</th>
                <th>Rol</th>
                <th>Estado</th>
                <th>Registro</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              @for (user of users; track user._id) {
              <tr>
                <td>
                  <div style="display: flex; align-items: center; gap: 12px;">
                    <img [src]="getUserAvatarPath(user.avatar || 'avatar1')" alt="Avatar" class="user-avatar">
                    <div>
                      <div style="font-weight: 600;">{{ user.username }}</div>
                      @if (user.biografia) {
                      <div style="font-size: 0.8rem; color: #666; margin-top: 2px;">{{ user.biografia }}</div>
                      }
                    </div>
                  </div>
                </td>
                <td>
                  <div>{{ user.email }}</div>
                  @if (user.isPremium) {
                  <div style="margin-top: 4px;">
                    <span class="badge-premium" style="font-size: 0.7rem; padding: 2px 6px;">Premium</span>
                  </div>
                  }
                </td>
                <td>
                  <span class="status-badge" [ngClass]="getRoleClass(user.role)">
                    {{ user.role }}
                  </span>
                </td>
                <td>
                  @if (user.isBanned) {
                  <div>
                    <span class="status-badge status-banned">Baneado</span>
                    @if (user.banExpiresAt) {
                    <div style="font-size: 0.7rem; color: #666; margin-top: 2px;">
                      Expira: {{ formatDate(user.banExpiresAt) }}
                    </div>
                    }
                    @if (user.banReason) {
                    <div style="font-size: 0.7rem; color: #e74c3c; margin-top: 2px;" [title]="user.banReason">
                      {{ user.banReason.length > 30 ? (user.banReason | slice:0:30) + '...' : user.banReason }}
                    </div>
                    }
                  </div>
                  } @else {
                  <span class="status-badge status-active">Activo</span>
                  }
                </td>
                <td>
                  <div>{{ formatDate(user.createdAt) }}</div>
                  @if (user.moderationHistory && user.moderationHistory.length > 0) {
                  <div style="font-size: 0.7rem; color: #666; margin-top: 2px;">
                    {{ user.moderationHistory.length }} acciones
                  </div>
                  }
                </td>
                <td>
                  <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                    @if (!user.isBanned && canBanUsers) {
                    <button class="action-btn btn-warning" (click)="openBanModal(user)"
                      [title]="'Banear a ' + user.username">
                      <i class="fas fa-ban"></i>
                      Ban
                    </button>
                    }

                    @if (user.isBanned && canBanUsers) {
                    <button class="action-btn btn-success" (click)="unbanUser(user)"
                      [title]="'Desbanear a ' + user.username">
                      <i class="fas fa-user-check"></i>
                      Unban
                    </button>
                    }

                    @if (isAdmin) {
                    <button class="action-btn btn-primary" (click)="openRoleModal(user)"
                      [title]="'Cambiar rol de ' + user.username">
                      <i class="fas fa-user-cog"></i>
                      Rol
                    </button>
                    }

                    @if (user.moderationHistory && user.moderationHistory.length > 0) {
                    <button class="action-btn btn-secondary" [title]="'Ver historial de ' + user.username">
                      <i class="fas fa-history"></i>
                      Historial
                    </button>
                    }
                  </div>
                </td>
              </tr>
              }
            </tbody>
          </table>
        </div>

        @if (pagination.users.hasMore) {
        <div class="pagination">
          <button class="load-more-btn" [disabled]="loading.users" (click)="loadMoreUsers()">
            @if (loading.users) {
            <i class="fas fa-spinner fa-spin"></i>
            Cargando...
            } @else {
            <i class="fas fa-chevron-down"></i>
            Cargar más usuarios
            }
          </button>
        </div>
        }
        } @else if (!loading.users) {
        <div style="text-align: center; padding: 40px; color: #666;">
          <i class="fas fa-users" style="font-size: 3rem; margin-bottom: 16px; opacity: 0.3;"></i>
          <p>No se encontraron usuarios con los filtros aplicados</p>
        </div>
        }
      </div>
    </div>

    <!-- Content Tab - Moderación de Contenido -->
    <div id="content" class="tab-content" [class.active]="tabState.activeTab === 'content'" *ngIf="canModerateContent">
      <div class="admin-card">
        <h3>
          <i class="fas fa-shield-alt"></i>
          Moderación de Contenido
        </h3>

        <!-- Sub-navegación de contenido -->
        <div class="content-tabs">
          <button class="content-tab" [class.active]="tabState.activeContentTab === 'reviews'"
            (click)="showContentTab('reviews')">
            <i class="fas fa-star"></i>
            Reseñas
          </button>

          <button class="content-tab" [class.active]="tabState.activeContentTab === 'comments'"
            (click)="showContentTab('comments')">
            <i class="fas fa-comments"></i>
            Comentarios
          </button>

          <button class="content-tab" [class.active]="tabState.activeContentTab === 'lists'"
            (click)="showContentTab('lists')">
            <i class="fas fa-list"></i>
            Listas
          </button>
        </div>

        <!-- Reseñas -->
        <div id="contentReviews" class="tab-content" [class.active]="tabState.activeContentTab === 'reviews'">
          @if (loading.reviews && reviews.length === 0) {
          <div class="loading">
            <i class="fas fa-spinner fa-spin"></i>
            Cargando reseñas...
          </div>
          }

          @if (errors.reviews) {
          <div class="error-message">
            <i class="fas fa-exclamation-triangle"></i>
            {{ errors.reviews }}
          </div>
          }

          @if (reviews.length > 0) {
          <div class="table-container">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Usuario</th>
                  <th>Película</th>
                  <th>Puntuación</th>
                  <th>Comentario</th>
                  <th>Fecha</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                @for (review of reviews; track review._id) {
                <tr>
                  <td>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <img [src]="getUserAvatarPath(review.userId.avatar)" alt="Avatar" class="user-avatar">
                      <div>
                        <div style="font-weight: 600;">{{ review.userId.username }}</div>
                        <span class="status-badge" [ngClass]="getRoleClass(review.userId.role)"
                          style="font-size: 0.7rem;">
                          {{ review.userId.role }}
                        </span>
                      </div>
                    </div>
                  </td>
                  <td>
                    <div style="font-weight: 600;">ID: {{ review.movieId }}</div>
                    <div style="font-size: 0.8rem; color: #666;">
                      <i class="fas fa-calendar"></i>
                      {{ formatDate(review.createdAt) }}
                    </div>
                  </td>
                  <td>
                    <div style="display: flex; align-items: center; gap: 4px;">
                      <span style="color: #f39c12; font-weight: 600; font-size: 1.1rem;">
                        {{ review.rating }}/10
                      </span>
                      <div style="color: #f39c12;">
                        @for (star of [1,2,3,4,5]; track star) {
                        <i class="fas fa-star" *ngIf="star <= (review.rating / 2)"></i>
                        <i class="far fa-star" *ngIf="star > (review.rating / 2)"></i>
                        }
                      </div>
                    </div>
                  </td>
                  <td>
                    <div [title]="review.comment" style="max-width: 300px;">
                      {{ review.comment.length > 100 ? (review.comment | slice:0:100) + '...' : review.comment }}
                    </div>
                    @if (review.comment.length > 100) {
                    <button class="action-btn btn-secondary"
                      style="margin-top: 4px; font-size: 0.7rem; padding: 2px 8px;">
                      <i class="fas fa-eye"></i>
                      Ver completo
                    </button>
                    }
                  </td>
                  <td>{{ formatDate(review.createdAt) }}</td>
                  <td>
                    <button class="action-btn btn-danger"
                      (click)="openDeleteModal('review', review._id, 'Reseña de ' + review.userId.username)">
                      <i class="fas fa-trash"></i>
                      Eliminar
                    </button>
                  </td>
                </tr>
                }
              </tbody>
            </table>
          </div>

          @if (pagination.reviews.hasMore) {
          <div class="pagination">
            <button class="load-more-btn" [disabled]="loading.reviews" (click)="loadMoreReviews()">
              @if (loading.reviews) {
              <i class="fas fa-spinner fa-spin"></i>
              Cargando...
              } @else {
              <i class="fas fa-chevron-down"></i>
              Cargar más reseñas
              }
            </button>
          </div>
          }
          } @else if (!loading.reviews) {
          <div style="text-align: center; padding: 40px; color: #666;">
            <i class="fas fa-star" style="font-size: 3rem; margin-bottom: 16px; opacity: 0.3;"></i>
            <p>No se encontraron reseñas para moderar</p>
          </div>
          }
        </div>

        <!-- Comentarios -->
        <div id="contentComments" class="tab-content" [class.active]="tabState.activeContentTab === 'comments'">
          @if (loading.comments && comments.length === 0) {
          <div class="loading">
            <i class="fas fa-spinner fa-spin"></i>
            Cargando comentarios...
          </div>
          }

          @if (errors.comments) {
          <div class="error-message">
            <i class="fas fa-exclamation-triangle"></i>
            {{ errors.comments }}
          </div>
          }

          @if (comments.length > 0) {
          <div class="table-container">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Usuario</th>
                  <th>Comentario</th>
                  <th>Reseña</th>
                  <th>Fecha</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                @for (comment of comments; track comment._id) {
                <tr>
                  <td>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <img [src]="getUserAvatarPath(comment.userId.avatar)" alt="Avatar" class="user-avatar">
                      <div>
                        <div style="font-weight: 600;">{{ comment.userId.username }}</div>
                        <span class="status-badge" [ngClass]="getRoleClass(comment.userId.role)"
                          style="font-size: 0.7rem;">
                          {{ comment.userId.role }}
                        </span>
                      </div>
                    </div>
                  </td>
                  <td>
                    <div [title]="comment.text" style="max-width: 300px;">
                      {{ comment.text.length > 100 ? (comment.text | slice:0:100) + '...' : comment.text }}
                    </div>
                    @if (comment.isEdited) {
                    <div style="font-size: 0.7rem; color: #666; margin-top: 2px;">
                      <i class="fas fa-edit"></i>
                      Editado
                    </div>
                    }
                  </td>
                  <td>
                    <div style="font-size: 0.8rem;">
                      <i class="fas fa-link"></i>
                      {{ comment.reviewId }}
                    </div>
                  </td>
                  <td>{{ formatDate(comment.createdAt) }}</td>
                  <td>
                    <button class="action-btn btn-danger"
                      (click)="openDeleteModal('comment', comment._id, 'Comentario de ' + comment.userId.username)">
                      <i class="fas fa-trash"></i>
                      Eliminar
                    </button>
                  </td>
                </tr>
                }
              </tbody>
            </table>
          </div>

          @if (pagination.comments.hasMore) {
          <div class="pagination">
            <button class="load-more-btn" [disabled]="loading.comments" (click)="loadMoreComments()">
              @if (loading.comments) {
              <i class="fas fa-spinner fa-spin"></i>
              Cargando...
              } @else {
              <i class="fas fa-chevron-down"></i>
              Cargar más comentarios
              }
            </button>
          </div>
          }
          } @else if (!loading.comments) {
          <div style="text-align: center; padding: 40px; color: #666;">
            <i class="fas fa-comments" style="font-size: 3rem; margin-bottom: 16px; opacity: 0.3;"></i>
            <p>No se encontraron comentarios para moderar</p>
          </div>
          }
        </div>

        <!-- Listas -->
        <div id="contentLists" class="tab-content" [class.active]="tabState.activeContentTab === 'lists'">
          @if (loading.lists && lists.length === 0) {
          <div class="loading">
            <i class="fas fa-spinner fa-spin"></i>
            Cargando listas...
          </div>
          }

          @if (errors.lists) {
          <div class="error-message">
            <i class="fas fa-exclamation-triangle"></i>
            {{ errors.lists }}
          </div>
          }

          @if (lists.length > 0) {
          <div class="table-container">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Usuario</th>
                  <th>Título</th>
                  <th>Descripción</th>
                  <th>Visibilidad</th>
                  <th>Películas</th>
                  <th>Fecha</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                @for (list of lists; track list._id) {
                <tr>
                  <td>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <img [src]="getUserAvatarPath(list.userId.avatar)" alt="Avatar" class="user-avatar">
                      <div>
                        <div style="font-weight: 600;">{{ list.userId.username }}</div>
                        <span class="status-badge" [ngClass]="getRoleClass(list.userId.role)"
                          style="font-size: 0.7rem;">
                          {{ list.userId.role }}
                        </span>
                      </div>
                    </div>
                  </td>
                  <td>
                    <div style="font-weight: 600;">{{ list.title }}</div>
                    @if (list.coverImage) {
                    <div style="font-size: 0.7rem; color: #666; margin-top: 2px;">
                      <i class="fas fa-image"></i>
                      Con imagen
                    </div>
                    }
                  </td>
                  <td>
                    <div [title]="list.description">
                      {{ list.description && list.description.length > 50 ? (list.description | slice:0:50) + '...' :
                      list.description || 'Sin descripción' }}
                    </div>
                  </td>
                  <td>
                    @if (list.isPublic) {
                    <span class="status-badge status-active">
                      <i class="fas fa-globe"></i>
                      Pública
                    </span>
                    } @else {
                    <span class="status-badge status-banned">
                      <i class="fas fa-lock"></i>
                      Privada
                    </span>
                    }
                  </td>
                  <td>
                    <div style="display: flex; align-items: center; gap: 4px;">
                      <i class="fas fa-film"></i>
                      <span style="font-weight: 600;">{{ list.movies.length || 0 }}</span>
                      películas
                    </div>
                  </td>
                  <td>{{ formatDate(list.createdAt) }}</td>
                  <td>
                    <button class="action-btn btn-danger" (click)="openDeleteModal('list', list._id, list.title)">
                      <i class="fas fa-trash"></i>
                      Eliminar
                    </button>
                  </td>
                </tr>
                }
              </tbody>
            </table>
          </div>

          @if (pagination.lists.hasMore) {
          <div class="pagination">
            <button class="load-more-btn" [disabled]="loading.lists" (click)="loadMoreLists()">
              @if (loading.lists) {
              <i class="fas fa-spinner fa-spin"></i>
              Cargando...
              } @else {
              <i class="fas fa-chevron-down"></i>
              Cargar más listas
              }
            </button>
          </div>
          }
          } @else if (!loading.lists) {
          <div style="text-align: center; padding: 40px; color: #666;">
            <i class="fas fa-list" style="font-size: 3rem; margin-bottom: 16px; opacity: 0.3;"></i>
            <p>No se encontraron listas para moderar</p>
          </div>
          }
        </div>
      </div>
    </div>

    <!-- Reports Tab -->
    <div id="reports" class="tab-content" [class.active]="tabState.activeTab === 'reports'" *ngIf="isModerator">
      <div class="admin-card">
        <h3>
          <i class="fas fa-flag"></i>
          Sistema de Reportes
        </h3>
        <div style="text-align: center; padding: 40px; color: #666;">
          <i class="fas fa-flag" style="font-size: 3rem; margin-bottom: 16px; opacity: 0.3;"></i>
          <p>Funcionalidad de reportes en desarrollo</p>
          <p>Próximamente: Gestión de reportes de usuarios y contenido</p>
        </div>
      </div>
    </div>

    <!-- Settings Tab -->
    <div id="settings" class="tab-content" [class.active]="tabState.activeTab === 'settings'" *ngIf="isAdmin">
      <div class="admin-card">
        <h3>
          <i class="fas fa-cogs"></i>
          Configuración del Sistema
        </h3>
        <div style="text-align: center; padding: 40px; color: #666;">
          <i class="fas fa-cogs" style="font-size: 3rem; margin-bottom: 16px; opacity: 0.3;"></i>
          <p>Configuraciones avanzadas en desarrollo</p>
          <p>Próximamente: Configuración global del sistema</p>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- Modal de Ban -->
@if (showBanModal) {
<div class="modal-overlay" (click)="closeModals()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>
        <i class="fas fa-ban"></i>
        Banear Usuario
      </h3>
      <button class="close-btn" (click)="closeModals()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <form [formGroup]="banForm" (ngSubmit)="banUser()">
      <div class="form-group">
        <label>
          <i class="fas fa-user"></i>
          Usuario:
        </label>
        <input type="text" [value]="modalData.username" readonly>
      </div>

      <div class="form-group">
        <label>
          <i class="fas fa-exclamation-triangle"></i>
          Razón del ban: *
        </label>
        <textarea formControlName="reason" placeholder="Describe la razón del ban..." required rows="3"></textarea>
        @if (banForm.get('reason')?.errors && banForm.get('reason')?.touched) {
        <div class="error-message" style="margin-top: 8px;">
          La razón es obligatoria y debe tener al menos 10 caracteres
        </div>
        }
      </div>

      <div class="form-group">
        <label>
          <i class="fas fa-clock"></i>
          Duración del ban:
        </label>
        <select formControlName="duration">
          <option value="">Permanente (sin expiración)</option>
          <option value="1">1 hora (temporal)</option>
          <option value="24">24 horas (1 día)</option>
          <option value="168">7 días (1 semana)</option>
          <option value="720">30 días (1 mes)</option>
        </select>
        <div class="form-help">
          @if (banForm.get('duration')?.value) {
          <span style="color: #f39c12;">
            <i class="fas fa-info-circle"></i>
            Ban temporal: {{ getBanDurationText(banForm.get('duration')?.value) }}
          </span>
          } @else {
          <span style="color: #e74c3c;">
            <i class="fas fa-exclamation-triangle"></i>
            Ban permanente: El usuario no podrá acceder nunca más
          </span>
          }
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="action-btn btn-secondary" (click)="closeModals()">
          <i class="fas fa-times"></i>
          Cancelar
        </button>
        <button type="submit" class="action-btn btn-danger" [disabled]="banForm.invalid || loading.banning">
          @if (loading.banning) {
          <i class="fas fa-spinner fa-spin"></i>
          Baneando...
          } @else {
          <i class="fas fa-ban"></i>
          Banear Usuario
          }
        </button>
      </div>
    </form>
  </div>
</div>
}

<!-- Modal de Cambio de Rol -->
@if (showRoleModal) {
<div class="modal-overlay" (click)="closeModals()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>
        <i class="fas fa-user-cog"></i>
        Cambiar Rol
      </h3>
      <button class="close-btn" (click)="closeModals()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <form [formGroup]="roleForm" (ngSubmit)="changeUserRole()">
      <div class="form-group">
        <label>
          <i class="fas fa-user"></i>
          Usuario:
        </label>
        <input type="text" [value]="modalData.username" readonly>
      </div>

      <div class="form-group">
        <label>
          <i class="fas fa-shield-alt"></i>
          Rol actual:
        </label>
        <div style="display: flex; align-items: center; gap: 8px;">
          <span class="status-badge" [ngClass]="getRoleClass(modalData.currentRole || '')">
            {{ modalData.currentRole }}
          </span>
        </div>
      </div>

      <div class="form-group">
        <label>
          <i class="fas fa-arrow-right"></i>
          Nuevo rol: *
        </label>
        <select formControlName="newRole" required>
          <option value="">Seleccionar rol</option>
          <option value="user">Usuario</option>
          <option value="premium">Premium</option>
          <option value="moderator">Moderador</option>
          <option value="admin">Administrador</option>
        </select>
        @if (roleForm.get('newRole')?.value) {
        <div class="form-help">
          <span class="status-badge" [ngClass]="getRoleClass(roleForm.get('newRole')?.value)">
            Nuevo rol: {{ roleForm.get('newRole')?.value }}
          </span>
        </div>
        }
      </div>

      <div class="form-group">
        <label>
          <i class="fas fa-comment"></i>
          Razón del cambio:
        </label>
        <textarea formControlName="reason" placeholder="Razón para el cambio de rol (opcional)..." rows="2"></textarea>
      </div>

      <div class="form-actions">
        <button type="button" class="action-btn btn-secondary" (click)="closeModals()">
          <i class="fas fa-times"></i>
          Cancelar
        </button>
        <button type="submit" class="action-btn btn-primary" [disabled]="roleForm.invalid">
          <i class="fas fa-save"></i>
          Cambiar Rol
        </button>
      </div>
    </form>
  </div>
</div>
}

<!-- Modal de Eliminación -->
@if (showDeleteModal) {
<div class="modal-overlay" (click)="closeModals()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>
        <i class="fas fa-trash"></i>
        Eliminar {{ capitalizeFirst(modalData.itemType || '') }}
      </h3>
      <button class="close-btn" (click)="closeModals()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <form [formGroup]="deleteForm" (ngSubmit)="deleteContent()">
      <div style="margin-bottom: 20px;">
        <div
          style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
          <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
            <i class="fas fa-exclamation-triangle" style="color: #e67e22;"></i>
            <strong>¿Estás seguro de que quieres eliminar?</strong>
          </div>
          <p style="margin: 0; color: #666;">{{ modalData.itemTitle }}</p>
        </div>

        <div style="background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 8px; padding: 12px;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <i class="fas fa-exclamation-circle" style="color: #e74c3c;"></i>
            <span style="color: #721c24; font-size: 14px; font-weight: 600;">
              Esta acción no se puede deshacer
            </span>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label>
          <i class="fas fa-comment"></i>
          Razón de la eliminación (opcional):
        </label>
        <textarea formControlName="reason" placeholder="Describe la razón de la eliminación..." rows="3"></textarea>
      </div>

      <div class="form-actions">
        <button type="button" class="action-btn btn-secondary" (click)="closeModals()">
          <i class="fas fa-times"></i>
          Cancelar
        </button>
        <button type="submit" class="action-btn btn-danger">
          <i class="fas fa-trash"></i>
          Eliminar Definitivamente
        </button>
      </div>
    </form>
  </div>
</div>
}